Search.setIndex({"docnames": ["components/attentions", "components/feedforward", "components/index", "components/mha", "components/ops", "components/position_embedding", "components/reversible", "custom_parts/index", "index", "tutorials/blocksparse", "tutorials/extend_attentions", "tutorials/index", "tutorials/reversible", "tutorials/sparse_vit", "tutorials/triton", "tutorials/use_attention", "what_is_xformers"], "filenames": ["components/attentions.rst", "components/feedforward.rst", "components/index.rst", "components/mha.rst", "components/ops.rst", "components/position_embedding.rst", "components/reversible.rst", "custom_parts/index.rst", "index.rst", "tutorials/blocksparse.rst", "tutorials/extend_attentions.rst", "tutorials/index.rst", "tutorials/reversible.rst", "tutorials/sparse_vit.rst", "tutorials/triton.rst", "tutorials/use_attention.rst", "what_is_xformers.rst"], "titles": ["Attention mechanisms", "Feedforward mechanisms", "API Reference", "Multi Head Attention", "xFormers optimized operators", "Position Embeddings", "Reversible layer", "Custom parts reference", "Welcome to xFormers\u2019s documentation!", "Using BlockSparseAttention", "Extend the xFormers parts zoo", "Tutorials", "Using the Reversible block", "Replace all attentions from an existing ViT model with a sparse equivalent?", "Using Triton-based layers", "I\u2019m only interested in testing out the attention mechanisms that are hosted here", "What is xFormers?"], "terms": {"xformer": [2, 7, 9, 11, 12, 13, 14, 15], "optim": [2, 8, 14, 16], "oper": [2, 8, 14], "memori": [2, 9, 12], "effici": [2, 12], "attent": [2, 7, 8, 9, 10, 11, 12], "mechan": [2, 8, 10, 11, 13], "feedforward": [2, 8, 12], "posit": [2, 8], "embed": [2, 8], "revers": [2, 8, 11], "layer": [2, 8, 11, 12], "multi": [2, 8, 12, 15], "head": [2, 8, 9, 12, 15], "transpar": 7, "support": [7, 13, 14], "implement": [7, 12], "comput": [7, 9, 12], "some": [7, 9, 12, 13, 14, 15], "which": [7, 8, 9, 10, 12, 13, 14, 15, 16], "ar": [7, 8, 10, 11, 12, 13, 14, 16], "base": [7, 8, 10, 11, 13, 15], "sputnik": 7, "These": [7, 14], "instal": 7, "from": [7, 8, 9, 10, 11, 12, 14, 15], "sourc": [7, 13, 16], "recipi": 7, "machin": 7, "abl": 7, "compil": [7, 14], "code": [7, 10, 14, 15], "git": 7, "clone": 7, "github": 7, "com": 7, "fairintern": 7, "conda": 7, "creat": [7, 8], "name": [7, 10, 13, 15], "xformer_env": 7, "python": [7, 14], "3": [7, 12, 13, 15], "8": [7, 9, 13], "activ": [7, 12], "cd": 7, "pip": 7, "r": [7, 12], "txt": 7, "e": 7, "common": 7, "issu": 7, "relat": [7, 12], "nvcc": 7, "current": [7, 14], "runtim": 7, "match": [7, 9], "you": [7, 9, 10, 12, 13, 14, 15, 16], "can": [7, 8, 9, 10, 12, 13, 14, 15, 16], "often": 7, "chang": [7, 9], "modul": [7, 10, 12, 13], "unload": 7, "load": 7, "xx": 7, "x": [7, 10, 12, 14, 15], "also": [7, 10, 12, 14, 16], "version": 7, "gcc": 7, "re": [7, 13, 15], "us": [7, 8, 10, 11, 13, 15], "capabl": [7, 14], "torch_cuda_arch_list": 7, "env": 7, "variabl": 7, "set": [7, 12], "architur": 7, "want": [7, 10, 13], "A": [7, 9, 12], "suggest": 7, "setup": 7, "slow": 7, "comprehens": 7, "export": 7, "6": [7, 9, 10], "0": [7, 9, 15], "7": 7, "The": [7, 9, 10, 12, 13, 14, 15], "automat": [7, 10, 16], "trigger": [7, 10], "when": [7, 12, 13, 14], "scale": 7, "dot": 7, "product": 7, "see": [7, 12], "enough": [7, 9], "mask": [7, 9, 13, 15], "less": [7, 12], "than": [7, 9, 12, 14], "30": 7, "true": [7, 9, 10, 12, 14], "valu": [7, 9, 16], "There": [7, 10, 14, 15], "noth": 7, "specif": [7, 16], "do": [7, 10, 13, 15], "coupl": [7, 10, 14], "exampl": [7, 9, 13, 14], "provid": [7, 9, 14, 15], "tutori": [7, 14], "we": [7, 9, 10, 12, 13, 15], "follow": [7, 10, 12, 13, 14, 16], "onli": [7, 8, 11, 14], "visibl": 7, "enabl": [7, 10, 14], "need": [7, 9, 10, 12], "ani": [7, 10, 13, 14, 16], "condit": 7, "met": 7, "warn": 7, "independ": 7, "model": [7, 8, 11, 12, 15, 16], "abov": [7, 12, 13], "limit": [7, 9, 14], "gpu": [7, 12, 14], "present": 7, "fullfil": 7, "thei": [7, 8], "default": [7, 10], "block": [7, 8, 9, 10, 11, 16], "pytorch": [8, 9, 13, 14], "librari": [8, 16], "host": [8, 11], "flexibl": [8, 16], "transform": [8, 13, 14, 16], "interoper": [8, 16], "build": [8, 9, 12, 15, 16], "option": [8, 10, 12], "combin": [8, 12, 15], "state": [8, 16], "art": [8, 16], "api": [8, 15], "refer": [8, 13, 16], "replac": [8, 11, 14], "all": [8, 10, 11, 12, 14, 15, 16], "an": [8, 9, 11, 14, 15], "exist": [8, 11], "vit": [8, 11], "spars": [8, 9, 11], "equival": [8, 11], "blocksparseattent": [8, 11], "extend": [8, 11, 16], "zoo": [8, 11, 16], "i": [8, 11], "m": [8, 11, 12], "interest": [8, 11], "test": [8, 10, 11, 16], "out": [8, 9, 11], "here": [8, 9, 11], "triton": [8, 9, 11], "cuda": [8, 9, 13, 14], "kernel": [8, 14], "blockspars": 9, "tile": 9, "defin": [9, 10, 12, 13, 16], "construct": [9, 10], "time": [9, 14], "simpl": 9, "causal": [9, 10], "just": [9, 13, 14], "lower": 9, "triangular": 9, "size": 9, "minimum": 9, "being": [9, 14, 16], "16": [9, 13, 15], "coeffici": 9, "one": [9, 10, 12, 13, 16], "dimens": [9, 14, 15], "If": 9, "alreadi": [9, 13], "have": [9, 13], "per": 9, "pattern": [9, 13], "mind": [9, 13], "thi": [9, 10, 12, 13, 14, 15, 16], "perfect": 9, "probabl": 9, "fine": [9, 15], "fast": [9, 16], "so": [9, 10, 14, 16], "drop": [9, 14], "after": 9, "fact": 9, "grain": 9, "still": 9, "better": [9, 14], "dens": 9, "small": 9, "helper": [9, 12, 13, 15], "maxpool": 9, "convert": 9, "between": [9, 12], "binari": 9, "layout": 9, "pleas": [9, 12, 13], "note": [9, 12, 13], "now": [9, 10, 13], "requir": [9, 10, 12], "sequenc": [9, 12, 14, 15], "length": 9, "power": 9, "two": [9, 12, 14, 15], "let": [9, 10, 13], "s": [9, 10, 13, 14, 15], "look": 9, "import": [9, 13, 14, 15], "torch": [9, 10, 12, 13, 14, 15], "compon": [9, 10, 12, 13, 15], "multiheaddispatch": [9, 15], "batch": [9, 10, 15], "2": [9, 12], "seq": [9, 15], "2048": 9, "emb": 9, "1024": [9, 15], "block_siz": 9, "32": 9, "dropout": [9, 10, 15], "1": [9, 12, 13, 14, 15], "dtype": 9, "float16": 9, "try": 9, "realli": [9, 16], "could": 9, "anyth": [9, 16], "causal_mask": 9, "tril": 9, "ones": 9, "devic": [9, 15], "causal_layout": 9, "our": [9, 13], "_you": 9, "pass": [9, 12], "differ": [9, 10, 12], "head_": 9, "num_head": [9, 10, 13, 15], "commod": 9, "multihead": [9, 15], "multi_head": [9, 15], "respons": 9, "forward": [9, 10, 12], "seq_len": [9, 15], "dim_model": [9, 15], "residual_dropout": [9, 15], "half": 9, "fw": [9, 12], "random": 9, "data": [9, 15], "make": [9, 12, 14, 15], "possibl": [9, 14, 15], "remov": 9, "extra": [9, 10, 12, 13], "where": 9, "blockif": 9, "queri": 9, "randn": 9, "requires_grad": 9, "self": [9, 10, 12], "particular": [9, 13], "att_val": 9, "kei": 9, "att_mask": [9, 13], "bonu": 9, "compar": [9, 12, 14, 16], "vs": 9, "def": [9, 10, 12, 13], "mem_us": 9, "fn": 9, "kwarg": [9, 10, 12], "titl": 9, "bookeep": 9, "start": [9, 14], "empty_cach": 9, "reset_peak_memory_stat": 9, "actual": [9, 14], "run": [9, 14], "function": [9, 12, 13], "synchron": 9, "stop": 9, "report": 9, "max_memori": 9, "max_memory_alloc": 9, "20": 9, "print": 9, "f": [9, 12], "peak": 9, "mb": 9, "round": 9, "1e6": 9, "1e3": 9, "ms": 9, "pytorch_multihead": 9, "nn": [9, 10, 12, 13, 14], "multiheadattent": 9, "batch_first": 9, "attn_mask": [9, 13], "On": 9, "v100": [9, 14], "9": 9, "someth": [9, 10, 12, 15], "along": [9, 14], "line": [9, 14], "151mb": 9, "619m": 9, "393mb": 9, "837m": 9, "matrix": 9, "empti": 9, "more": [9, 10, 12, 13, 15, 16], "get": [9, 12, 13, 14], "bias": 9, "result": [9, 14], "toward": 9, "done": 10, "privat": 10, "fork": 10, "work": [10, 13, 15], "progress": 10, "would": [10, 13, 15], "like": [10, 12, 13, 14, 15], "share": 10, "point": [10, 14], "directli": [10, 14, 15], "order": 10, "submit": 10, "pr": [10, 16], "regist": 10, "architectur": [10, 15, 16], "practic": [10, 13], "unit": [10, 14], "loos": 10, "inherit": 10, "expos": [10, 12, 13, 15], "exact": 10, "same": [10, 12], "interfac": [10, 14], "consid": [10, 12, 13], "instanc": 10, "nystrom": 10, "dataclass": 10, "class": [10, 12], "nystromselfattentionconfig": 10, "attentionconfig": 10, "register_attent": 10, "nystromattent": 10, "__init__": [10, 12], "float": 10, "int": [10, 12], "num_landmark": 10, "64": 10, "landmark_pool": 10, "none": [10, 14], "bool": [10, 12], "fals": [10, 12, 13, 14], "use_razavi_pinvers": 10, "pinverse_original_init": 10, "inv_iter": 10, "recommend": 10, "paper": [10, 12], "wa": [10, 12, 15], "v_skip_connect": 10, "conv_kernel_s": 10, "arg": 10, "q": 10, "tensor": [10, 12, 13, 14], "k": 10, "v": 10, "thing": 10, "remark": 10, "other": [10, 12, 13, 14, 16], "extens": [10, 16], "appli": [10, 12], "configur": 10, "explicitli": 10, "constructor": 10, "It": [10, 14], "benchmark": [10, 14, 16], "accept": 10, "argument": 10, "even": 10, "field": [10, 16], "registr": 10, "snippet": 10, "both": 10, "given": [10, 13, 15, 16], "ti": 10, "type": 10, "open": [10, 12], "up": [10, 12], "least": 10, "three": 10, "tool": 10, "toolbox": 10, "relev": [10, 16], "pick": 10, "new": [10, 15, 16], "variant": [10, 16], "call": 10, "them": [10, 12, 14], "go": 10, "pytest": 10, "my_component_nam": 10, "applic": [10, 12, 14], "lra": 10, "json": 10, "config": 10, "your": [10, 12, 15], "job": 10, "As": [10, 14], "remind": 10, "inform": 10, "dedic": 10, "readm": 10, "local": [10, 14, 16], "python3": [10, 14], "run_task": 10, "py": [10, 14], "task": 10, "config_path": 10, "world_siz": 10, "n": [10, 12], "slurm": 10, "cluster": 10, "batch_submit": 10, "c": 10, "ck": 10, "checkpo": 10, "log": [10, 14], "path": [10, 12, 15], "part": 11, "residu": 12, "first": 12, "propos": [12, 13, 14, 16], "gomez": 12, "et": 12, "al": 12, "Its": 12, "context": 12, "reform": 12, "larg": 12, "unrel": 12, "lsh": 12, "chunk": 12, "mlp": 12, "process": 12, "veri": [12, 14, 15], "lightli": 12, "adapt": 12, "robin": 12, "bruegger": 12, "lucidrain": 12, "input": [12, 15], "x1": 12, "x2": 12, "produc": 12, "output": [12, 13], "y1": 12, "y2": 12, "via": 12, "g": 12, "turn": [12, 15], "mean": [12, 16], "recov": 12, "detail": 12, "anoth": 12, "effect": 12, "checkpoint": 12, "tradeoff": 12, "One": 12, "benefit": 12, "wrap": 12, "natur": 12, "distribut": 12, "free": 12, "help": 12, "save": 12, "commun": 12, "cost": 12, "moreov": 12, "made": 12, "stack": 12, "doe": 12, "increas": [12, 14], "number": [12, 14], "includ": 12, "mha": 12, "norm": 12, "close": 12, "exactli": 12, "origin": 12, "formul": 12, "vaswani": 12, "deal": 12, "dim": [12, 13], "accuraci": 12, "should": [12, 15], "affect": 12, "verifi": 12, "repositori": [12, 13], "main": 12, "reversibleblock": 12, "reversiblesequ": 12, "take": [12, 13, 15], "sequenti": 12, "similarli": 12, "modulelist": 12, "f_arg": 12, "g_arg": 12, "arg_rout": 12, "whether": [12, 15], "rout": 12, "boolean": 12, "complet": [12, 15], "factori": 12, "model_factori": 12, "yet": 12, "compat": [12, 14], "multipl": 12, "ddp": 12, "xformerstackconfig": 12, "block_config": 12, "union": 12, "xformerencoderconfig": 12, "xformerdecoderconfig": 12, "num_lay": 12, "becom": [12, 15], "ren": 12, "urtasun": 12, "gross": 12, "b": 12, "2017": 12, "network": 12, "backpropag": 12, "without": 12, "store": 12, "kitaev": 12, "kaiser": 12, "\u0142": 12, "levskaya": 12, "2020": 12, "sai": 13, "experi": 13, "show": 13, "how": [13, 14], "reus": [13, 16], "imag": 13, "aspect": 13, "translat": 13, "well": 13, "In": [13, 14, 15], "case": [13, 14, 15], "check": 13, "notebook": 13, "exhaust": 13, "timm": 13, "vision_transform": 13, "visiontransform": 13, "scaleddotproduct": 13, "timm_sparse_attent": 13, "timmsparseattent": 13, "img_siz": 13, "224": 13, "patch_siz": 13, "embed_dim": 13, "96": 13, "depth": 13, "mlp_ratio": 13, "qkv_bia": 13, "norm_lay": 13, "layernorm": 13, "suppos": 13, "snipper": 13, "precis": 13, "sever": 13, "attention_pattern": 13, "my_fancy_mask": 13, "recurs": 13, "monkei": 13, "patch": 13, "replace_attn_with_xformers_on": 13, "module_output": 13, "isinst": 13, "qkv": 13, "weight": 13, "shape": 13, "paramet": [13, 15], "minim": 13, "child": 13, "named_children": 13, "add_modul": 13, "del": 13, "return": 13, "awar": [13, 14], "variat": 13, "exchang": 13, "altern": [13, 15], "mai": 13, "good": 13, "idea": 13, "closer": 13, "typic": [13, 14], "exhibit": 13, "clear": 13, "sparsiti": 13, "alter": 13, "manual": 13, "sparsifi": 13, "languag": 14, "parallel": 14, "program": 14, "pure": 14, "mani": 14, "primit": 14, "tranform": 14, "correspond": 14, "each": [14, 16], "backend": 14, "short": 14, "jit": 14, "toolchain": 14, "famili": 14, "consolid": 14, "ad": 14, "hoc": 14, "goal": 14, "over": 14, "last": 14, "avail": 14, "similar": [14, 15], "http": 14, "lang": 14, "org": 14, "02": 14, "html": 14, "sphx": 14, "glr": 14, "log_softmax": 14, "y": 14, "amp": 14, "autograd": 14, "expect": [14, 15], "throughput": 14, "nvidia": 14, "operand": 14, "relu": 14, "simpli": 14, "fusedlinearlay": 14, "my_linear_lay": 14, "in_featur": 14, "out_featur": 14, "squared_relu": 14, "skip": 14, "either": [14, 15], "septemb": 14, "2021": 14, "faster": 14, "non": 14, "sigmoid": 14, "fp16": 14, "usecas": 14, "serv": 14, "measur": [14, 16], "perform": 14, "laptop": 14, "3080": 14, "10": 14, "reproduc": 14, "benchmark_triton_layernorm": 14, "gb": 14, "benchmark_triton_dropout": 14, "That": 15, "own": 15, "everyth": 15, "depend": 15, "requires_head_dimens": 15, "flag": 15, "build_attent": 15, "dict": 15, "defer": 15, "lot": 15, "instanti": 15, "littl": 15, "obscur": 15, "although": 15, "hopefulli": 15, "straightforward": 15, "initi": 15, "built": 15, "intern": 15, "sure": 15, "programat": 15, "allow": [15, 16], "sweep": 15, "search": [15, 16], "definit": 15, "384": 15, "my_config": 15, "attention_nam": 15, "easili": [15, 16], "file": 15, "attention_query_mask": 15, "rand": 15, "dummi": 15, "dispatch": 15, "my": 15, "focus": 16, "agnost": 16, "design": 16, "compos": 16, "ideal": 16, "break": 16, "inspir": 16, "studi": 16, "ablat": 16, "aim": 16, "easi": 16, "focu": 16, "improv": 16, "against": 16, "across": 16, "domain": 16, "engin": 16, "effort": 16, "And": 16, "sinc": 16, "cannot": 16, "heavi": 16, "everi": 16, "repo": 16, "alon": 16, "happen": 16, "anytim": 16, "somebodi": 16, "through": 16, "crowd": 16, "welcom": 16, "move": 16, "too": 16}, "objects": {"xformers": [[7, 0, 0, "-", "triton"]]}, "objtypes": {"0": "py:module"}, "objnames": {"0": ["py", "module", "Python module"]}, "titleterms": {"attent": [0, 3, 4, 13, 15], "mechan": [0, 1, 15], "feedforward": 1, "api": 2, "refer": [2, 7], "multi": 3, "head": 3, "xformer": [4, 8, 10, 16], "optim": 4, "oper": 4, "memori": 4, "effici": 4, "avail": 4, "implement": 4, "bias": 4, "non": 4, "autograd": 4, "posit": 5, "embed": 5, "revers": [6, 12], "layer": [6, 14], "custom": [7, 8], "part": [7, 8, 10], "spars": [7, 13], "cuda": 7, "kernel": 7, "1": 7, "build": 7, "2": 7, "usag": 7, "triton": [7, 14], "requir": 7, "possibl": 7, "welcom": 8, "s": 8, "document": 8, "compon": 8, "tutori": [8, 11], "exampl": 8, "some": 8, "us": [9, 12, 14], "blocksparseattent": 9, "extend": 10, "zoo": 10, "block": 12, "intro": 12, "transform": 12, "In": 12, "practic": 12, "replac": 13, "all": 13, "from": 13, "an": 13, "exist": 13, "vit": 13, "model": 13, "equival": 13, "base": 14, "fuse": 14, "softmax": 14, "linear": 14, "norm": 14, "dropout": 14, "bia": 14, "activ": 14, "i": 15, "m": 15, "onli": 15, "interest": 15, "test": 15, "out": 15, "ar": 15, "host": 15, "here": 15, "what": 16}, "envversion": {"sphinx.domains.c": 2, "sphinx.domains.changeset": 1, "sphinx.domains.citation": 1, "sphinx.domains.cpp": 6, "sphinx.domains.index": 1, "sphinx.domains.javascript": 2, "sphinx.domains.math": 2, "sphinx.domains.python": 3, "sphinx.domains.rst": 2, "sphinx.domains.std": 2, "sphinx.ext.intersphinx": 1, "sphinx.ext.todo": 2, "sphinx.ext.viewcode": 1, "sphinx": 56}})